<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Båtspill med Speedometer og Kollisjon</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #333;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
            background-color: #006994;
        }
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 18px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            pointer-events: none;
        }
        #speedometer {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 24px;
            background: rgba(0, 0, 0, 0.5);
            padding: 12px 18px;
            border-radius: 5px;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="ui">
        <strong>Kontroller:</strong><br>
        ⬆️ Pil opp: Gi gass<br>
        ⬇️ Pil ned: Brems / Rygg<br>
        ⬅️ ➡️ Piler: Sving
    </div>

    <div id="speedometer">Fart: 0 km/t</div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Oppdater øy-posisjon som er avhengig av canvas-størrelse
        islands[1].x = canvas.width - 200;
        islands[1].y = canvas.height - 300;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // Tastaturhåndtering
    const keys = {
        ArrowUp: false,
        ArrowDown: false,
        ArrowLeft: false,
        ArrowRight: false
    };

    // Hindre scrolling
    window.addEventListener('keydown', (e) => {
        if (keys.hasOwnProperty(e.code)) {
            e.preventDefault();
            keys[e.code] = true;
        }
    });

    window.addEventListener('keyup', (e) => {
        if (keys.hasOwnProperty(e.code)) {
            e.preventDefault();
            keys[e.code] = false;
        }
    });

    // Båt-objektet
    const boat = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        angle: -Math.PI / 2,
        speed: 0,
        maxSpeed: 6, // 6 tilsvarer 1000 km/t
        acceleration: 0.1,
        friction: 0.98,
        rotationSpeed: 0.06,
        radius: 10 // brukt til kollisjon
    };

    // Øyer (land)
    const islands = [
        { x: 200, y: 200, r: 40 },
        { x: canvas.width - 200, y: canvas.height - 300, r: 60 }
    ];

    const particles = [];

    function createParticle() {
        const offset = 20;
        particles.push({
            x: boat.x - Math.cos(boat.angle) * offset + (Math.random() - 0.5) * 5,
            y: boat.y - Math.sin(boat.angle) * offset + (Math.random() - 0.5) * 5,
            life: 1.0,
            size: Math.random() * 3 + 1
        });
    }

    function updateSpeedometer() {
        const speedElement = document.getElementById("speedometer");
        const kmh = Math.abs((boat.speed / boat.maxSpeed) * 1000);
        speedElement.textContent = "Fart: " + kmh.toFixed(0) + " km/t";
    }

    function checkCollisionWithIslands() {
        for (const island of islands) {
            const dx = boat.x - island.x;
            const dy = boat.y - island.y;
            const dist = Math.sqrt(dx * dx + dy * dy);

            if (dist < island.r + boat.radius) {
                // Flytt båten litt tilbake i motsatt retning av bevegelsen
                boat.x -= Math.cos(boat.angle) * boat.speed;
                boat.y -= Math.sin(boat.angle) * boat.speed;

                // Stopp båten
                boat.speed = 0;
            }
        }
    }

    function update() {
        if (Math.abs(boat.speed) > 0.1) {
            const direction = boat.speed > 0 ? 1 : -1;
            if (keys.ArrowLeft) boat.angle -= boat.rotationSpeed * direction;
            if (keys.ArrowRight) boat.angle += boat.rotationSpeed * direction;
        }

        if (keys.ArrowUp) boat.speed += boat.acceleration;
        else if (keys.ArrowDown) boat.speed -= boat.acceleration;

        boat.speed *= boat.friction;

        boat.x += Math.cos(boat.angle) * boat.speed;
        boat.y += Math.sin(boat.angle) * boat.speed;

        // Kollisjon med land
        checkCollisionWithIslands();

        // Wrap rundt skjermkant
        if (boat.x > canvas.width) boat.x = 0;
        if (boat.x < 0) boat.x = canvas.width;
        if (boat.y > canvas.height) boat.y = 0;
        if (boat.y < 0) boat.y = canvas.height;

        if (Math.abs(boat.speed) > 1) createParticle();

        for (let i = particles.length - 1; i >= 0; i--) {
            particles[i].life -= 0.02;
            if (particles[i].life <= 0) particles.splice(i, 1);
        }
    }

    function draw() {
        ctx.fillStyle = '#006994';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Tegn øyer fra listen
        ctx.fillStyle = '#2e8b57';
        for (const island of islands) {
            ctx.beginPath();
            ctx.arc(island.x, island.y, island.r, 0, Math.PI * 2);
            ctx.fill();
        }

        // Bølger/partikler
        ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
        particles.forEach(p => {
            ctx.globalAlpha = p.life;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            ctx.fill();
        });
        ctx.globalAlpha = 1.0;

        // Tegn båt
        ctx.save();
        ctx.translate(boat.x, boat.y);
        ctx.rotate(boat.angle);

        ctx.fillStyle = '#d4af37';
        ctx.beginPath();
        ctx.moveTo(15, 0);
        ctx.lineTo(-15, 10);
        ctx.lineTo(-10, 0);
        ctx.lineTo(-15, -10);
        ctx.closePath();
        ctx.fill();

        ctx.fillStyle = '#8b4513';
        ctx.fillRect(-10, -5, 10, 10);

        ctx.restore();
    }

    function gameLoop() {
        update();
        updateSpeedometer();
        draw();
        requestAnimationFrame(gameLoop);
    }

    gameLoop();
</script>

</body>
</html>
